#!/bin/bash

# Start script for mybinder.org
# This ensures the EOPF-Zarr driver environment is properly configured

# Set GDAL environment variables
export GDAL_DRIVER_PATH="/opt/eopf-zarr/drivers"
export GDAL_DATA="/usr/share/gdal"
export PROJ_LIB="/usr/share/proj"

# Verify driver is available
echo "üîç Initializing EOPF-Zarr driver environment..."

# Check if driver file exists
if [ -f "/opt/eopf-zarr/drivers/gdal_EOPFZarr.so" ]; then
    echo "‚úÖ EOPF-Zarr driver found"
else
    echo "‚ö†Ô∏è EOPF-Zarr driver not found - may need to rebuild"
fi

# Initialize GDAL with the custom driver
python3 -c "
import os
os.environ['GDAL_DRIVER_PATH'] = '/opt/eopf-zarr/drivers'
from osgeo import gdal
gdal.AllRegister()
print(f'GDAL initialized with {gdal.GetDriverCount()} drivers')
"

# Start the notebook server
exec "$@"
